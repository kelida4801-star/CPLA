<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 CPLA í•©ê²© ë§¤ë‹ˆì € V2.0</title>
    <style>
        @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css");
        :root {
            --bg: #f5f7fa; --card: #ffffff; --text: #2d3436;
            --border: #dfe6e9; --shadow: rgba(0, 0, 0, 0.08);
            --primary: #0984e3; --accent: #00b894; --danger: #d63031; --warning: #fdcb6e;
            --info: #6c5ce7;
        }
        body.dark {
            --bg: #1e272e; --card: #2f3542; --text: #f1f2f6;
            --border: #57606f; --shadow: rgba(0, 0, 0, 0.3);
        }
        body { font-family: "Pretendard", sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; transition: 0.3s; padding-bottom: 200px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* í—¤ë” ë ˆì´ì•„ì›ƒ */
        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
        .header h1 { font-size: 1.8rem; font-weight: 900; letter-spacing: -1px; margin: 0; }
        .dday-container { display: flex; flex-direction: column; gap: 8px; align-items: flex-end; }
        .d-day { padding: 6px 14px; border-radius: 12px; font-weight: 900; font-size: 0.85rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); white-space: nowrap; }
        .d-day.first { background: var(--info); color: white; }
        .d-day.second { background: var(--danger); color: white; }

        /* ë„¤ë¹„ê²Œì´ì…˜ íƒ­ */
        .nav-wrapper { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 2px solid var(--border); margin-bottom: 25px; gap: 10px; }
        .tabs-left { display: flex; gap: 5px; overflow-x: auto; -ms-overflow-style: none; scrollbar-width: none; flex: 1; }
        .tabs-left::-webkit-scrollbar { display: none; }
        .tabs-right { display: flex; gap: 2px; }

        .tab-btn { padding: 12px 14px; border: none; background: none; font-size: 0.9rem; font-weight: 700; color: #b2bec3; cursor: pointer; position: relative; white-space: nowrap; transition: 0.2s; }
        .tab-btn.active { color: var(--primary); }
        .tab-btn.active::after { content: ""; position: absolute; bottom: -2px; left: 0; width: 100%; height: 3px; background: var(--primary); border-radius: 3px; }
        .tab-btn.utility { color: var(--info); }
        .tab-btn.utility.active { color: var(--info); }
        .tab-btn.utility.active::after { background: var(--info); }

        /* ì¡°ì‘ ê°€ì´ë“œ ë°°ì§€ ì‹œìŠ¤í…œ */
        .guide-dashboard { background: rgba(9, 132, 227, 0.05); border-radius: 20px; padding: 20px; margin-bottom: 30px; border-left: 6px solid var(--primary); display: flex; justify-content: space-between; align-items: center; gap: 20px; }
        .guide-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; flex: 1; }
        .guide-item { background: var(--card); padding: 8px 12px; border-radius: 12px; border: 1px solid var(--border); display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 5px var(--shadow); }
        .guide-key { font-size: 0.7rem; background: var(--bg); padding: 2px 6px; border-radius: 4px; color: var(--primary); font-weight: 900; border: 1px solid var(--border); }
        .guide-desc { font-size: 0.8rem; font-weight: 700; color: #4b5563; }

        /* ê³¼ëª© ì¹´ë“œ ë””ìì¸ */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 25px; }
        .card { background: var(--card); border-radius: 28px; padding: 25px; box-shadow: 0 15px 35px var(--shadow); border: 1px solid var(--border); transition: transform 0.2s; position: relative; }
        
        .subject-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; gap: 15px; }
        .subject-info { flex: 1; min-width: 0; }
        .subject-title-area { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .subject-title-area h3 { margin: 0; font-size: 1.2rem; font-weight: 900; cursor: pointer; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .subject-title-area h3:hover { color: var(--primary); }
        
        .subject-meta { font-size: 0.85rem; display: flex; align-items: center; gap: 12px; color: #636e72; flex-wrap: nowrap; }
        .subject-meta span { white-space: nowrap; display: flex; align-items: center; gap: 4px; }
        .input-max { width: 42px; border: none; background: var(--bg); border-radius: 6px; padding: 3px; text-align: center; font-weight: 800; font-family: inherit; font-size: 0.8rem; }
        
        .subject-actions { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
        .btn-mini { height: 32px; min-width: 60px; padding: 0 12px; font-size: 0.75rem; border-radius: 8px; background: var(--bg); border: 1px solid var(--border); color: #636e72; font-weight: 700; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; white-space: nowrap; }
        .btn-mini:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-mini.danger:hover { background: var(--danger); border-color: var(--danger); }
        .btn-close { font-size: 1.2rem; padding: 0 5px; color: #b2bec3; cursor: pointer; transition: 0.2s; margin-left: 4px; display: flex; align-items: center; }
        .btn-close:hover { color: var(--danger); transform: scale(1.1); }

        /* ë¬¸í•­ ê·¸ë¦¬ë“œ */
        .num-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 6px; margin-top: 15px; }
        .num-item { 
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center; 
            font-size: 0.85rem; border-radius: 10px; border: 1px solid var(--border); cursor: pointer; 
            position: relative; font-weight: 800; transition: 0.2s; background: var(--card); overflow: hidden;
            user-select: none;
        }
        .progress-fill { position: absolute; bottom: 0; left: 0; width: 100%; background-color: var(--item-color); opacity: 0.7; transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1; }
        .num-text { position: relative; z-index: 2; }
        .num-item.max-lv .num-text { color: white; }
        .num-item.max-lv { background-color: var(--item-color); }
        .num-item.due { border: 3px solid var(--warning) !important; animation: pulse 2s infinite; }
        
        /* ì•„ì´ì½˜ ì ˆëŒ€ ìœ„ì¹˜ ê³ ì • ë° ê²¹ì¹¨ ë°©ì§€ */
        .num-item.mastered { border: 2.5px solid var(--accent) !important; color: var(--accent) !important; background: none !important; }
        .num-item.mastered::after { content: "ğŸ†"; position: absolute; font-size: 0.55rem; top: 1px; right: 1px; z-index: 3; }
        .weight-tag { position: absolute; bottom: 1px; left: 1px; font-size: 0.55rem; color: var(--danger); display: none; z-index: 3; line-height: 1; }
        .has-weight .weight-tag { display: block; }
        .topic-dot { position: absolute; bottom: 3px; right: 3px; width: 4px; height: 4px; background: var(--danger); border-radius: 50%; display: none; z-index: 3; }
        .has-topic .topic-dot { display: block; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(253, 203, 110, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(253, 203, 110, 0); } 100% { box-shadow: 0 0 0 0 rgba(253, 203, 110, 0); } }

        /* í…Œì´ë¸” ë° íˆìŠ¤í† ë¦¬ ë ˆì´ì•„ì›ƒ ìµœì í™” */
        .schedule-table-wrapper { background: var(--card); border-radius: 24px; box-shadow: 0 10px 30px var(--shadow); overflow-x: auto; margin-top: 10px; border: 1px solid var(--border); }
        .schedule-table { width: 100%; border-collapse: collapse; min-width: 800px; }
        .schedule-table th { background: #f8f9fa; padding: 18px 15px; text-align: left; font-weight: 900; font-size: 0.85rem; border-bottom: 2px solid var(--border); color: #636e72; }
        .schedule-table td { padding: 18px 15px; border-bottom: 1px solid var(--border); font-size: 0.95rem; vertical-align: middle; }
        .schedule-table tr:hover td { background: rgba(9, 132, 227, 0.03); }
        .status-badge { display: inline-block; padding: 6px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 900; }

        /* ë‹¬ë ¥ ê³ ë„í™” */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; margin-top: 20px; }
        .calendar-day { background: var(--card); border: 1px solid var(--border); border-radius: 20px; min-height: 140px; padding: 12px; position: relative; transition: 0.2s; }
        .calendar-day:hover { transform: translateY(-3px); box-shadow: 0 5px 15px var(--shadow); }
        .calendar-date { font-weight: 900; font-size: 0.95rem; margin-bottom: 10px; display: block; }
        .calendar-item { font-size: 0.7rem; padding: 4px 8px; border-radius: 7px; margin-bottom: 5px; color: white; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 800; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: calc(100% - 16px); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .calendar-day.today { border: 2.5px solid var(--primary); background: rgba(9, 132, 227, 0.02); }
        .calendar-day.other-month { opacity: 0.35; background: transparent; }

        /* ë¶„ì„ ëŒ€ì‹œë³´ë“œ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stats-card { background: var(--card); border-radius: 24px; padding: 22px; border: 1px solid var(--border); box-shadow: 0 10px 25px var(--shadow); }
        .stats-card h4 { margin: 0 0 10px 0; color: #636e72; font-size: 0.9rem; font-weight: 800; }
        .stats-value { font-size: 1.8rem; font-weight: 900; color: var(--primary); letter-spacing: -1px; }
        .heatmap-bar { height: 14px; background: #f1f2f6; border-radius: 7px; overflow: hidden; margin-top: 8px; border: 1px solid var(--border); }
        .heatmap-fill { height: 100%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }

        /* ìµœê·¼ ì¶”ì¶œ ì´ë ¥ */
        .history-section { background: var(--card); border-radius: 24px; padding: 25px; border: 1px solid var(--border); margin-top: 40px; box-shadow: 0 10px 30px var(--shadow); }
        .history-list { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .history-item { background: var(--bg); padding: 14px 20px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; transition: 0.2s; }
        .history-item:hover { border-color: var(--primary); background: var(--card); }
        .history-time { font-family: monospace; font-weight: 900; color: var(--primary); margin-right: 20px; font-size: 0.95rem; }
        .history-result { font-weight: 700; font-size: 0.95rem; flex: 1; color: var(--text); }

        /* í•˜ë‹¨ ì œì–´íŒ */
        .control-panel { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 900px; background: var(--card); padding: 20px; border-radius: 30px; box-shadow: 0 -15px 50px rgba(0,0,0,0.15); display: flex; gap: 12px; border: 1px solid var(--border); z-index: 100; align-items: center; }
        .btn { border: none; border-radius: 18px; cursor: pointer; font-weight: 900; padding: 16px; transition: 0.3s; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: var(--primary); color: white; flex: 2; }
        .btn-warning { background: var(--warning); color: #2d3436; flex: 1.2; }
        .btn-sub { background: var(--bg); color: var(--text); border: 1px solid var(--border); flex: 0.5; }

        /* ë„ì›€ë§ ìŠ¤íƒ€ì¼ */
        .help-box { line-height: 1.9; color: var(--text); padding: 10px; }
        .help-section { margin-bottom: 40px; padding: 25px; background: var(--bg); border-radius: 24px; border: 1px solid var(--border); }
        .help-section h4 { color: var(--primary); margin-top: 0; margin-bottom: 15px; font-size: 1.3rem; font-weight: 900; display: flex; align-items: center; gap: 10px; }
        .help-section p { margin-bottom: 15px; color: var(--text); font-weight: 700; font-size: 1.05rem; }
        .help-section ul { padding-left: 0; margin: 0; list-style: none; }
        .help-section li { margin-bottom: 12px; position: relative; padding-left: 25px; font-weight: 500; }
        .help-section li::before { content: "âœ…"; position: absolute; left: 0; font-size: 0.9rem; }
        
        .qa-card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .qa-q { font-weight: 900; color: var(--info); display: block; margin-bottom: 8px; font-size: 1.1rem; }
        .qa-a { font-weight: 500; font-size: 0.95rem; color: #4b5563; }

        #modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); padding: 40px; border-radius: 35px; box-shadow: 0 30px 100px rgba(0,0,0,0.4); display: none; z-index: 1000; text-align: center; min-width: 380px; max-width: 550px; border: 2px solid var(--primary); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; z-index: 999; backdrop-filter: blur(8px); }
        .subject-checkbox { width: 20px; height: 20px; cursor: pointer; accent-color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 id="main-title">ğŸš€ CPLA í•©ê²© ë§¤ë‹ˆì €</h1>
        <div class="dday-container">
            <div id="dday-1st" class="d-day first"></div>
            <div id="dday-2nd" class="d-day second"></div>
        </div>
    </div>

    <div class="nav-wrapper">
        <nav class="tabs-left" id="tab-list-left"></nav>
        <div class="tabs-right">
            <button class="tab-btn utility" id="tab-calendar" onclick="switchTab('calendar')">ğŸ“… ë‹¬ë ¥</button>
            <button class="tab-btn utility" id="tab-stats" onclick="switchTab('stats')">ğŸ“Š ë¶„ì„</button>
            <button class="tab-btn utility" id="tab-log" onclick="switchTab('log')">ğŸ“œ ì´ë ¥</button>
            <button class="tab-btn utility" id="tab-schedule" onclick="switchTab('schedule')">ğŸ”„ ë³µìŠµ</button>
            <button class="tab-btn utility" id="tab-help" onclick="switchTab('help')">ğŸ“– ë„ì›€ë§</button>
        </div>
    </div>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <div id="main-view">
        <div class="guide-dashboard">
            <div class="guide-grid">
                <div class="guide-item"><span class="guide-key">í´ë¦­</span><span class="guide-desc">í•™ìŠµì™„ë£Œ</span></div>
                <div class="guide-item"><span class="guide-key">Ctrl</span><span class="guide-desc">ì£¼ì œì…ë ¥</span></div>
                <div class="guide-item"><span class="guide-key">ìš°í´ë¦­</span><span class="guide-desc">ê°€ì¤‘ì¹˜ğŸ”¥</span></div>
                <div class="guide-item"><span class="guide-key">Alt</span><span class="guide-desc">ë§ˆìŠ¤í„°ğŸ†</span></div>
                <div class="guide-item"><span class="guide-key">Shift</span><span class="guide-desc">ë°ì´í„°ë¦¬ì…‹</span></div>
            </div>
            <button class="btn-mini" style="padding: 8px 18px; border-radius: 12px; min-width: 100px;" onclick="addNewSubject()">+ ê³¼ëª© ì¶”ê°€</button>
        </div>
        <div id="subject-grid" class="grid-container"></div>
        <div class="history-section">
            <h3 style="margin:0; font-weight:900;">ğŸ•’ ìµœê·¼ ì¶”ì¶œ ì´ë ¥</h3>
            <div class="history-list" id="history-content"></div>
        </div>
    </div>

    <!-- ë‹¬ë ¥ ë·° -->
    <div id="calendar-view" style="display:none;">
        <div class="calendar-header">
            <h2 id="calendar-title" style="color:var(--primary); margin:0; font-weight:900;"></h2>
            <div style="display:flex; gap:12px;">
                <button class="btn-mini" onclick="changeMonth(-1)">â—€ ì´ì „</button>
                <button class="btn-mini" onclick="changeMonth(0)">ì˜¤ëŠ˜</button>
                <button class="btn-mini" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
            </div>
        </div>
        <div class="calendar-grid" id="calendar-grid"></div>
    </div>

    <!-- ë¶„ì„ ë·° -->
    <div id="stats-view" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
            <h2 style="color:var(--primary); margin:0; font-weight:900;">ğŸ“Š ìƒì„¸ ìˆ˜í—˜ ë°ì´í„° ë¶„ì„</h2>
            <select id="stats-book-select" onchange="renderStats()" style="padding:12px 20px; border-radius:15px; border:1px solid var(--border); font-weight:800; cursor:pointer; background:var(--card); color:var(--text);">
            </select>
        </div>
        <div class="stats-grid" id="simulation-summary"></div>
        <div class="schedule-table-wrapper" id="heatmap-container"></div>
    </div>

    <!-- ë³µìŠµ ì¼ì • ë·° -->
    <div id="schedule-view" style="display:none;">
        <h2 style="color:var(--info); font-weight:900;">ğŸ”„ ì—ë¹™í•˜ìš°ìŠ¤ ë³µìŠµ ë¦¬ìŠ¤íŠ¸</h2>
        <div class="schedule-table-wrapper" id="schedule-container"></div>
    </div>

    <!-- ì´ë ¥ ë·° -->
    <div id="log-view" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="color:var(--info); margin:0; font-weight:900;">ğŸ“œ ìƒì„¸ í•™ìŠµ ì™„ë£Œ ê¸°ë¡</h2>
            <button class="btn-mini danger" style="padding:10px 20px;" onclick="clearLogs()">ë¡œê·¸ ì „ì²´ ì‚­ì œ</button>
        </div>
        <div class="schedule-table-wrapper" id="log-container"></div>
    </div>

    <!-- ë„ì›€ë§ ë·° -->
    <div id="help-view" style="display:none;">
        <div class="help-box">
            <div class="help-section">
                <h4>ğŸ§  ì—ë¹™í•˜ìš°ìŠ¤ ë³µìŠµ ë§¤ì»¤ë‹ˆì¦˜</h4>
                <p>ë³¸ ë§¤ë‹ˆì €ëŠ” ì§€ëŠ¥í˜• ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ ë§ê°ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤.</p>
                <ul>
                    <li>`ë ˆë²¨ ì‹œìŠ¤í…œ`: í•™ìŠµ ì‹œë§ˆë‹¤ ë°°ê²½ìƒ‰ ê²Œì´ì§€ê°€ `1/6`ì”© ì±„ì›Œì§€ë©° ì¥ê¸° ê¸°ì–µìœ¼ë¡œ ì „ì´ë©ë‹ˆë‹¤.</li>
                    <li>`ë³µìŠµ ì£¼ê¸° ì˜ˆì•½`: ë ˆë²¨ì— ë”°ë¼ [1ì¼, 3ì¼, 7ì¼, 14ì¼, 30ì¼, 45ì¼, 60ì¼] ê°„ê²©ìœ¼ë¡œ ë‹¤ìŒ í•™ìŠµì¼ì´ ìë™ ì§€ì •ë©ë‹ˆë‹¤.</li>
                    <li>`ìš°ì„ ìˆœìœ„ ì¶”ì¶œ`: ì¶”ì¶œ ë²„íŠ¼ í´ë¦­ ì‹œ, ì˜ˆì •ì¼ì´ ë„ë˜í•œ ë¬¸í•­ì„ 1ìˆœìœ„, ë¯¸í•™ìŠµ ë¬¸í•­ì„ 2ìˆœìœ„ë¡œ ì„ ë³„í•©ë‹ˆë‹¤.</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>ğŸ¯ ê¸°ëŠ¥ í™œìš© ê°€ì´ë“œ</h4>
                <ul>
                    <li>`ê°€ì¤‘ì¹˜(ğŸ”¥)`: ìœ ë… ì•ˆ ì™¸ì›Œì§€ëŠ” ë¬¸í•­ì€ ìš°í´ë¦­í•˜ì„¸ìš”. ë³µìŠµ ì£¼ê¸°ê°€ `0.5ë°°`ë¡œ ë‹¨ì¶•ë˜ì–´ ë‚¨ë“¤ë³´ë‹¤ 2ë°° ë” ìì£¼ ê³µë¶€í•©ë‹ˆë‹¤.</li>
                    <li>`ë§ˆìŠ¤í„°(ğŸ†)`: ì™„ë²½íˆ ì•”ê¸°ëœ ë¬¸í•­ì€ Alt+í´ë¦­í•˜ì„¸ìš”. ì¶”ì¶œ ëŒ€ìƒì—ì„œ ì˜êµ¬ ì œì™¸ë˜ì–´ íš¨ìœ¨ì„ ë†’ì…ë‹ˆë‹¤.</li>
                    <li>`ë³´ë„ˆìŠ¤ ë³µìŠµ`: ëª¨ë“  ë¬¸í•­ì„ 1íšŒ ì´ìƒ í•™ìŠµí•˜ê³  ë³µìŠµ ì˜ˆì •ì¼ë„ ë„ë˜í•˜ì§€ ì•Šì•˜ì„ ë•Œ, ì‹œìŠ¤í…œì´ ë¬´ì‘ìœ„ ë¬¸í•­ì„ `[ë³´ë„ˆìŠ¤ ë³µìŠµ]`ìœ¼ë¡œ ì¶”ì²œí•˜ì—¬ ê°ì„ ìƒì§€ ì•Šê²Œ ë•ìŠµë‹ˆë‹¤.</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>ğŸ’¾ ë°ì´í„° ë°±ì—… ë° ë³µì›</h4>
                <div style="display:flex; gap:15px; margin-top:15px;">
                    <button class="btn btn-sub" style="flex:1; background:white;" onclick="exportData()">ğŸ“¤ ë°±ì—… ì½”ë“œ ë³µì‚¬</button>
                    <button class="btn btn-sub" style="flex:1; background:white;" onclick="importData()">ğŸ“¥ ë°±ì—… ë°ì´í„° ë³µì›</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="control-panel">
    <button class="btn btn-sub" onclick="toggleTheme()" title="í…Œë§ˆ ë³€ê²½">ğŸŒ“</button>
    <button class="btn btn-warning" onclick="extractWeighted()">ğŸ”¥ ì§‘ì¤‘ í•™ìŠµ ì¶”ì¶œ</button>
    <button class="btn btn-primary" onclick="extractDaily()">ì„ íƒ ê³¼ëª© ì˜¤ëŠ˜ì˜ ë¬¸ì œ ì¶”ì¶œ</button>
</div>

<div id="overlay" class="overlay" onclick="closeModal()"></div>
<div id="modal">
    <h2 id="modal-title" style="color:var(--primary); margin-top:0;">ğŸ¯ í•™ìŠµ ë¯¸ì…˜</h2>
    <div id="modal-content" style="margin: 25px 0; line-height: 2.2; font-weight: 800; text-align: left; font-size: 1.15rem;"></div>
    <button class="btn btn-primary" style="width:100%" onclick="closeModal()">ë¯¸ì…˜ ìˆ˜í–‰ ì‹œì‘</button>
</div>

<script>
    const examDate1st = new Date("2026-05-23");
    const examDate2nd = new Date("2026-08-29");
    const intervals = [0, 1, 3, 7, 14, 30, 45, 60]; 
    const colors = ["#0984e3", "#d63031", "#00b894", "#6c5ce7", "#fdcb6e", "#fab1a0", "#00cec9", "#636e72"];

    let appData = JSON.parse(localStorage.getItem("cpla_ebbinghaus_v3_0_stable")) || {
        activeTab: "basic",
        tabs: [{id: "basic", name: "ê¸°ë³¸ì„œ"}, {id: "case", name: "ì‚¬ë¡€ì§‘"}],
        books: { "basic": getDefaultSubjects(), "case": getDefaultSubjects() },
        history: [],
        logs: []
    };

    let calendarDate = new Date();

    function getDefaultSubjects() {
        return ["ë…¸ë™ë²• 1", "ë…¸ë™ë²• 2", "ì¸ì‚¬ë…¸ë¬´ê´€ë¦¬", "í–‰ì •ìŸì†¡ë²•", "ë…¸ë™ê²½ì œí•™"].map((name, i) => ({ 
            name, color: colors[i % colors.length], max: 50, records: {}, extractEnabled: true 
        }));
    }

    function save() { localStorage.setItem("cpla_ebbinghaus_v3_0_stable", JSON.stringify(appData)); }

    function renderTabs() {
        const tabList = document.getElementById("tab-list-left");
        if (!tabList) return;
        tabList.innerHTML = appData.tabs.map(t => `
            <button class="tab-btn ${appData.activeTab === t.id ? "active" : ""}" onclick="switchTab('${t.id}')">
                ${t.name}
                <span style="font-size:0.7rem; opacity:0.4; margin-left:5px;" onclick="deleteTab(event, '${t.id}')">âœ•</span>
            </button>
        `).join("") + `<button class="tab-btn" style="color:var(--accent)" onclick="addTab()">+ êµì¬ ì¶”ê°€</button>`;
        updateUtilityTabStyles();
    }

    function updateUtilityTabStyles() {
        ["calendar", "stats", "log", "schedule", "help"].forEach(id => {
            const el = document.getElementById(`tab-${id}`);
            if (el) el.className = `tab-btn utility ${appData.activeTab === id ? "active" : ""}`;
        });
    }

    function switchTab(id) {
        appData.activeTab = id;
        const views = ["main-view", "calendar-view", "stats-view", "schedule-view", "log-view", "help-view"];
        views.forEach(v => { const el = document.getElementById(v); if (el) el.style.display = "none"; });

        if (["calendar", "stats", "log", "schedule", "help"].includes(id)) {
            const viewEl = document.getElementById(`${id}-view`);
            if (viewEl) viewEl.style.display = "block";
            if (id === "calendar") renderCalendar();
            if (id === "stats") { updateStatsBookSelect(); renderStats(); }
            if (id === "schedule") renderSchedule();
            if (id === "log") renderLogs();
        } else {
            document.getElementById("main-view").style.display = "block";
        }
        
        const tab = appData.tabs.find(t => t.id === id);
        const titleEl = document.getElementById("main-title");
        if (titleEl) {
            if (tab && !["calendar", "stats", "log", "schedule", "help"].includes(id)) {
                titleEl.innerText = `ğŸš€ ${tab.name} ë§¤ë‹ˆì €`;
            } else {
                const names = {calendar:"ğŸ“… í•™ìŠµ ë‹¬ë ¥", stats:"ğŸ“Š ìˆ˜í—˜ ë¶„ì„", log:"ğŸ“œ í•™ìŠµ ì´ë ¥", schedule:"ğŸ”„ ë³µìŠµ ì¼ì •", help:"ğŸ“– ê°€ì´ë“œ"};
                titleEl.innerText = `ğŸš€ ${names[id] || "CPLA í•©ê²© ë§¤ë‹ˆì €"}`;
            }
        }
        render(); renderTabs(); save();
    }

    function renderCalendar() {
        const grid = document.getElementById("calendar-grid");
        const title = document.getElementById("calendar-title");
        if(!grid || !title) return;
        grid.innerHTML = "";
        const year = calendarDate.getFullYear();
        const month = calendarDate.getMonth();
        title.innerText = `${year}ë…„ ${month + 1}ì›”`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const prevDaysInMonth = new Date(year, month, 0).getDate();
        const today = new Date().toISOString().split("T")[0];

        const dateMap = {};
        Object.values(appData.books).forEach(subjects => {
            subjects.forEach(s => {
                Object.keys(s.records).forEach(num => {
                    const rec = s.records[num];
                    if (rec.nextDate && !rec.mastered) {
                        if (!dateMap[rec.nextDate]) dateMap[rec.nextDate] = [];
                        dateMap[rec.nextDate].push({ name: s.name, num, color: s.color });
                    }
                });
            });
        });

        for (let i = firstDay - 1; i >= 0; i--) { grid.appendChild(createDayEl(prevDaysInMonth - i, true, null)); }
        for (let i = 1; i <= daysInMonth; i++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(i).padStart(2, "0")}`;
            grid.appendChild(createDayEl(i, false, dateMap[dateStr], dateStr === today));
        }

        function createDayEl(day, other, items, isToday) {
            const div = document.createElement("div");
            div.className = `calendar-day ${other ? "other-month" : ""} ${isToday ? "today" : ""}`;
            let html = `<span class="calendar-date">${day}</span>`;
            if (items) {
                items.slice(0, 5).forEach(item => {
                    html += `<div class="calendar-item" style="background:${item.color}">${item.name} ${item.num}</div>`;
                });
                if (items.length > 5) html += `<div style="font-size:0.6rem; text-align:center; font-weight:800; color:#b2bec3;">+${items.length-5} more</div>`;
            }
            div.innerHTML = html;
            return div;
        }
    }

    function changeMonth(val) { calendarDate.setMonth(calendarDate.getMonth() + (val === 0 ? 0 : val)); if(val === 0) calendarDate = new Date(); renderCalendar(); }

    function updateStatsBookSelect() {
        const select = document.getElementById("stats-book-select");
        if(!select) return;
        const currentVal = select.value;
        select.innerHTML = appData.tabs.map(t => `<option value="${t.id}">${t.name}</option>`).join("");
        if (appData.books[currentVal]) select.value = currentVal;
        else select.value = appData.tabs[0].id;
    }

    function renderStats() {
        const summary = document.getElementById("simulation-summary");
        const heatmap = document.getElementById("heatmap-container");
        const bookSelect = document.getElementById("stats-book-select");
        if (!summary || !heatmap || !bookSelect) return;
        const bookId = bookSelect.value;
        const subjects = appData.books[bookId];
        if (!subjects) return;

        let totalItems = 0, totalPoints = 0, totalResets = 0, totalWeights = 0;
        let subjectStats = [];
        subjects.forEach(s => {
            let sPoints = 0, sResets = 0, sWeights = 0;
            totalItems += s.max;
            for (let i = 1; i <= s.max; i++) {
                const rec = s.records[i] || { level: 0, weight: 1, resetCount: 0 };
                sPoints += Math.min(rec.level, 6);
                sResets += (rec.resetCount || 0);
                if (rec.weight < 1) sWeights++;
            }
            totalPoints += sPoints; totalResets += sResets; totalWeights += sWeights;
            subjectStats.push({ name: s.name, points: sPoints, max: s.max * 6, resets: sResets, weights: sWeights, color: s.color });
        });

        const target = totalItems * 6; const remain = target - totalPoints;
        const days = Math.max(1, Math.ceil((examDate2nd - new Date()) / (1000 * 60 * 60 * 24)));
        const speed = (remain / days).toFixed(2);

        summary.innerHTML = `<div class="stats-card"><h4>ëˆ„ì  ë§ˆìŠ¤í„°ë¦¬</h4><div class="stats-value">${totalPoints} / ${target}</div></div><div class="stats-card"><h4>2ì°¨ ê¶Œì¥ ì†ë„</h4><div class="stats-value">ì¼ì¼ ${speed} Lv UP</div></div><div class="stats-card"><h4>ì¥ì• ë¬¼ ë° ì •ì²´</h4><div class="stats-value">ğŸ”¥${totalWeights} / ğŸ”„${totalResets}</div></div>`;
        heatmap.innerHTML = `<table class="schedule-table"><thead><tr><th>ê³¼ëª©ëª…</th><th>í•™ìŠµ íˆíŠ¸ë§µ</th><th style="text-align:center;">ì·¨ì•½(ğŸ”¥)</th><th style="text-align:center;">ì •ì²´(ğŸ”„)</th></tr></thead><tbody>` + 
            subjectStats.map(s => {
                const p = ((s.points / s.max) * 100).toFixed(1);
                return `<tr><td style="font-weight:900; color:${s.color}">${s.name}</td><td><div style="font-size:0.75rem; font-weight:800; margin-bottom:5px;">Progress: ${p}%</div><div class="heatmap-bar"><div class="heatmap-fill" style="width:${p}%; background:${s.color}"></div></div></td><td style="text-align:center; font-weight:900; color:var(--danger)">${s.weights}</td><td style="text-align:center; font-weight:900; color:var(--info)">${s.resets}</td></tr>`;
            }).join("") + `</tbody></table>`;
    }

    function render() {
        const grid = document.getElementById("subject-grid");
        const subjects = appData.books[appData.activeTab];
        if (!grid || !subjects) return;

        grid.innerHTML = subjects.map((s, sIdx) => {
            let items = ""; let dueCount = 0; const today = new Date().toISOString().split("T")[0];
            for (let i = 1; i <= s.max; i++) {
                const rec = s.records[i] || { level: 0, weight: 1, topic: "", resetCount: 0 };
                const isDue = rec.nextDate && rec.nextDate <= today;
                if(isDue && !rec.mastered) dueCount++;
                const fillHeight = Math.min((rec.level / 6) * 100, 100);
                const tooltip = rec.level > 0 ? `Lv.${rec.level}${rec.weight < 1 ? " | ğŸ”¥" : ""}${rec.resetCount > 0 ? " | ğŸ”„"+rec.resetCount : ""}${rec.topic ? " | "+rec.topic : ""} | Next: ${rec.nextDate}` : "í•™ìŠµ ì „ ë¬¸í•­";
                items += `<div class="num-item ${rec.level >= 6 ? "max-lv" : ""} ${isDue && !rec.mastered ? "due" : ""} ${rec.mastered ? "mastered" : ""} ${rec.weight < 1 ? "has-weight" : ""} ${rec.topic ? "has-topic" : ""}" style="--item-color: ${s.color}" title="${tooltip}" onclick="handleItemClick(event, ${sIdx}, ${i})" oncontextmenu="toggleWeight(event, ${sIdx}, ${i})"><div class="progress-fill" style="height: ${fillHeight}%;"></div><span class="num-text">${i}</span><span class="weight-tag">ğŸ”¥</span><div class="topic-dot"></div></div>`;
            }
            return `<div class="card"><div class="subject-top"><div class="subject-info"><div class="subject-title-area"><input type="checkbox" class="subject-checkbox" ${s.extractEnabled ? "checked" : ""} onchange="toggleSubjectExtract(${sIdx})"><h3 style="color:${s.color};" onclick="renameSubject(${sIdx})" title="ì´ë¦„ ìˆ˜ì •">${s.name}</h3></div><div class="subject-meta"><span>ë³µìŠµ í•„ìš”: <b style="color:var(--danger)">${dueCount}</b></span><span>ë¬¸í•­: <input type="number" class="input-max" value="${s.max}" onchange="updateMax(${sIdx}, this.value)"></span></div></div><div class="subject-actions"><button class="btn-mini" onclick="batchCheck(${sIdx})">ë²”ìœ„</button><button class="btn-mini danger" onclick="resetSubject(${sIdx})">ì´ˆê¸°í™”</button><span class="btn-close" onclick="deleteSubject(${sIdx})" title="ê³¼ëª© ì‚­ì œ">âœ•</span></div></div><div class="num-grid">${items}</div></div>`;
        }).join("");
        renderHistory();
    }

    function renderSchedule() {
        const container = document.getElementById("schedule-container");
        if (!container) return;
        let rows = []; const today = new Date().toISOString().split("T")[0];
        Object.keys(appData.books).forEach(bookId => {
            const bookName = appData.tabs.find(t => t.id === bookId)?.name || "ê¸°íƒ€";
            appData.books[bookId].forEach(s => {
                Object.keys(s.records).forEach(num => {
                    const rec = s.records[num];
                    if (rec.level > 0) {
                        rows.push({ subject: `[${bookName}] ${s.name}`, num, topic: rec.topic || "-", level: rec.level, next: rec.nextDate, status: rec.mastered ? "ğŸ† ì™„ë£Œ" : (rec.nextDate <= today ? "ğŸ”´ ì‹œê¸‰" : "ğŸŸ¢ ëŒ€ê¸°") });
                    }
                });
            });
        });
        rows.sort((a, b) => a.next.localeCompare(b.next));
        container.innerHTML = `<table class="schedule-table"><thead><tr><th style="width:25%">ê³¼ëª©ëª…</th><th style="width:10%">ë²ˆí˜¸</th><th style="width:30%">ìŸì /ì£¼ì œ</th><th style="width:10%">Lv</th><th style="width:15%">ì˜ˆì •ì¼</th><th style="width:10%">ìƒíƒœ</th></tr></thead><tbody>` + 
            (rows.map(r => `<tr><td style="font-weight:900;">${r.subject}</td><td style="text-align:center;">${r.num}ë²ˆ</td><td style="color:#636e72; font-weight:600;">${r.topic}</td><td style="text-align:center; font-weight:900;">${r.level}</td><td style="font-family:monospace; font-weight:800;">${r.next}</td><td><span class="status-badge" style="background:${r.status.includes("ğŸ”´") ? "#fff0f0" : (r.status.includes("ğŸ†") ? "#e6fff2" : "#f0f7ff")}; color:${r.status.includes("ğŸ”´") ? "var(--danger)" : (r.status.includes("ğŸ†") ? "var(--accent)" : "var(--primary)")};">${r.status}</span></td></tr>`).join("") || `<tr><td colspan="6" style="text-align:center; padding:60px; color:#888; font-weight:800;">í•™ìŠµ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</td></tr>`) + `</tbody></table>`;
    }

    function renderLogs() {
        const container = document.getElementById("log-container");
        if (!container || !appData.logs || appData.logs.length === 0) {
            if(container) container.innerHTML = `<div style="text-align:center; padding:60px; color:#888; font-weight:800;">í•™ìŠµ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
        }
        container.innerHTML = `<table class="schedule-table"><thead><tr><th style="width:20%">ì™„ë£Œ ì¼ì‹œ</th><th style="width:20%">êµì¬</th><th style="width:20%">ê³¼ëª©</th><th style="width:10%">ë²ˆí˜¸</th><th style="width:20%">í•™ìŠµê²°ê³¼</th><th style="width:10%">ê´€ë¦¬</th></tr></thead><tbody>` + 
            appData.logs.map((l, idx) => `<tr><td style="font-family:monospace; font-weight:800;">${l.date} ${l.time}</td><td>${l.book}</td><td style="font-weight:900;">${l.subject}</td><td style="text-align:center;">${l.num}ë²ˆ</td><td><span class="status-badge" style="background:#e6fff2; color:var(--accent);">Lv.${l.level} UP</span></td><td><button class="btn-mini danger" onclick="deleteLog(${idx})">ì‚­ì œ</button></td></tr>`).join("") + `</tbody></table>`;
    }

    function handleItemClick(e, sIdx, num) {
        const s = appData.books[appData.activeTab][sIdx];
        const tabObj = appData.tabs.find(t => t.id === appData.activeTab);
        if (e.ctrlKey) { setTopic(sIdx, num); return; }
        if (e.shiftKey) { if(confirm(`[${num}ë²ˆ ë°ì´í„° ë¦¬ì…‹]\në¯¸í•™ìŠµ ìƒíƒœë¡œ ëŒë¦´ê¹Œìš”?`)) { if(s.records[num]) s.records[num].resetCount = (s.records[num].resetCount || 0) + 1; if(s.records[num]) { s.records[num].level = 0; s.records[num].nextDate = ""; } save(); render(); } return; }
        if (e.altKey) { if (!s.records[num]) s.records[num] = { level: 0, weight: 1, topic: "", resetCount: 0 }; s.records[num].mastered = !s.records[num].mastered; save(); render(); return; }
        if(confirm(`[${s.name} ${num}ë²ˆ]\ní•™ìŠµì„ ì™„ë£Œí•˜ê³  ë ˆë²¨ì„ ì˜¬ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?`)) { processLevelUp(s, tabObj.name, num); save(); render(); }
    }

    function processLevelUp(s, tabName, num) {
        if (!s.records[num]) s.records[num] = { level: 0, weight: 1, topic: "", resetCount: 0 };
        const rec = s.records[num]; rec.level++; rec.lastDate = new Date().toISOString().split("T")[0];
        const gap = (intervals[Math.min(rec.level, intervals.length - 1)] || 60) * (rec.weight || 1);
        const next = new Date(); next.setDate(next.getDate() + Math.ceil(gap)); rec.nextDate = next.toISOString().split("T")[0];
        const now = new Date(); if(!appData.logs) appData.logs = [];
        appData.logs.unshift({ date: rec.lastDate, time: now.toLocaleTimeString([], {hour: "2-digit", minute: "2-digit"}), book: tabName, subject: s.name, num: num, level: rec.level });
        if (appData.logs.length > 100) appData.logs.pop();
    }

    function extractDaily() {
        const subjects = appData.books[appData.activeTab];
        let results = [], logText = ""; const today = new Date().toISOString().split("T")[0];
        subjects.forEach(s => {
            if (!s.extractEnabled) return;
            let dueItems = [], newItems = [], learnedItems = [];
            for (let i = 1; i <= s.max; i++) {
                const rec = s.records[i];
                if (rec && !rec.mastered && rec.nextDate && rec.nextDate <= today) dueItems.push(i);
                else if (!rec || rec.level === 0) newItems.push(i);
                else if (rec && !rec.mastered) learnedItems.push(i);
            }
            // 1ìˆœìœ„: ë³µìŠµ ì˜ˆì • / 2ìˆœìœ„: ì‹ ê·œ / 3ìˆœìœ„(ì „ì²´ ì™„ë£Œ ì‹œ): ë¬´ì‘ìœ„ ë³´ë„ˆìŠ¤ ë³µìŠµ
            if (dueItems.length > 0) {
                const pick = dueItems[Math.floor(Math.random() * dueItems.length)];
                results.push(`<span style="color:${s.color}">[ë³µìŠµ] ${s.name}</span>: ${pick}ë²ˆ${s.records[pick]?.topic ? ` (${s.records[pick].topic})` : ""}`);
                logText += `${s.name}(${pick}) `;
            } else if (newItems.length > 0) {
                const pick = newItems[Math.floor(Math.random() * newItems.length)];
                results.push(`<span style="color:${s.color}">[ì‹ ê·œ] ${s.name}</span>: ${pick}ë²ˆ`);
                logText += `${s.name}(${pick}) `;
            } else if (learnedItems.length > 0) {
                const pick = learnedItems[Math.floor(Math.random() * learnedItems.length)];
                results.push(`<span style="color:${s.color}">[ë³´ë„ˆìŠ¤ ë³µìŠµ] ${s.name}</span>: ${pick}ë²ˆ${s.records[pick]?.topic ? ` (${s.records[pick].topic})` : ""}`);
                logText += `${s.name}(${pick} ) `;
            }
        });
        if (results.length > 0) { appData.history.unshift({ time: new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"}), result: logText }); if (appData.history.length > 10) appData.history.pop(); showModal("ì˜¤ëŠ˜ì˜ í•™ìŠµ ë¯¸ì…˜", results.join("<br>")); save(); render(); }
        else { alert("ì¶”ì¶œí•  ìˆ˜ ìˆëŠ” ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤."); }
    }

    function extractWeighted() {
        const subjects = appData.books[appData.activeTab];
        let weights = [];
        subjects.forEach(s => {
            if (!s.extractEnabled) return;
            Object.keys(s.records).forEach(num => { const rec = s.records[num]; if (rec.weight < 1 && !rec.mastered) weights.push({ sName: s.name, color: s.color, num }); });
        });
        if (weights.length === 0) return alert("ê°€ì¤‘ì¹˜(ğŸ”¥) ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.");
        const pick = weights.sort(() => 0.5 - Math.random()).slice(0, 5);
        showModal("ğŸ”¥ ì§‘ì¤‘ í•™ìŠµ ë¯¸ì…˜", pick.map(p => `<span style="color:${p.color}">[ì§‘ì¤‘] ${p.sName}</span>: ${p.num}ë²ˆ`).join("<br>"));
    }

    function deleteHistory(idx) { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { appData.history.splice(idx, 1); save(); renderHistory(); } }
    function renderHistory() { 
        const el = document.getElementById("history-content");
        if (el) el.innerHTML = appData.history.map((h, idx) => `
            <div class="history-item">
                <span class="history-time">${h.time}</span>
                <span class="history-result">${h.result}</span>
                <button class="btn-close" onclick="deleteHistory(${idx})">âœ•</button>
            </div>`).join("") || `<div style="text-align:center; color:#888; padding:30px; font-weight:800;">ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>`; 
    }

    function updateMax(sIdx, val) { appData.books[appData.activeTab][sIdx].max = parseInt(val) || 50; save(); render(); }
    function renameSubject(sIdx) { const cn = appData.books[appData.activeTab][sIdx].name; const n = prompt("ê³¼ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:", cn); if (n) { appData.books[appData.activeTab][sIdx].name = n.trim(); save(); render(); } }
    function addNewSubject() { const n = prompt("ìƒˆ ê³¼ëª© ì´ë¦„:"); if (n) { appData.books[appData.activeTab].push({ name: n.trim(), color: colors[appData.books[appData.activeTab].length % colors.length], max: 50, records: {}, extractEnabled: true }); save(); render(); } }
    function deleteSubject(sIdx) { const sn = appData.books[appData.activeTab][sIdx].name; if(confirm(`[${sn}] ê³¼ëª©ì„ ì˜êµ¬ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { appData.books[appData.activeTab].splice(sIdx, 1); save(); render(); } }
    function resetSubject(sIdx) { if(confirm("ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { appData.books[appData.activeTab][sIdx].records = {}; save(); render(); } }
    function setTopic(sIdx, num) { const s = appData.books[appData.activeTab][sIdx]; if (!s.records[num]) s.records[num] = { level: 0, weight: 1, topic: "", resetCount: 0 }; const t = prompt(`[${num}ë²ˆ ì£¼ì œ ì…ë ¥]`, s.records[num].topic); if(t !== null) { s.records[num].topic = t.trim(); save(); render(); } }
    function toggleWeight(e, sIdx, num) { e.preventDefault(); const s = appData.books[appData.activeTab][sIdx]; if (!s.records[num]) s.records[num] = { level: 0, weight: 1, topic: "", resetCount: 0 }; s.records[num].weight = s.records[num].weight === 1 ? 0.5 : 1; save(); render(); }
    function exportData() { navigator.clipboard.writeText(btoa(encodeURIComponent(JSON.stringify(appData)))); alert("ë°±ì—… ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"); }
    function importData() { const d = prompt("ë°±ì—… ì½”ë“œ ì…ë ¥:"); if(d) { try { appData = JSON.parse(decodeURIComponent(atob(d))); save(); location.reload(); } catch(e) { alert("ì½”ë“œ ì˜¤ë¥˜"); } } }
    function batchCheck(sIdx) {
        const s = appData.books[appData.activeTab][sIdx]; const tabObj = appData.tabs.find(t => t.id === appData.activeTab);
        const r = prompt(`[${s.name} ë²”ìœ„ ì²´í¬] (ì˜ˆ: 1-10)`); if (!r) return;
        let start, end; if (r.includes("-")) { [start, end] = r.split("-").map(Number); } else { start = end = Number(r); }
        if (isNaN(start) || isNaN(end) || start < 1 || end > s.max || start > end) return alert("ìœ íš¨í•˜ì§€ ì•Šì€ ë²”ìœ„ì…ë‹ˆë‹¤.");
        if (confirm(`${start}ë²ˆ~${end}ë²ˆ ì¼ê´„ ë ˆë²¨ì—… í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { for (let i = start; i <= end; i++) { processLevelUp(s, tabObj.name, i); } save(); render(); }
    }
    function showModal(t, c) { document.getElementById("modal-title").innerText = t; document.getElementById("modal-content").innerHTML = c; document.getElementById("modal").style.display = "block"; document.getElementById("overlay").style.display = "block"; }
    function closeModal() { document.getElementById("modal").style.display = "none"; document.getElementById("overlay").style.display = "none"; }
    function toggleTheme() { document.body.classList.toggle("dark"); }
    function addTab() { const n = prompt("ìƒˆ êµì¬ ëª…ì¹­:"); if(n) { const id = "tab_"+Date.now(); appData.tabs.push({id, name: n.trim()}); appData.books[id] = getDefaultSubjects(); switchTab(id); } }
    function deleteTab(e, id) { e.stopPropagation(); const tn = appData.tabs.find(t => t.id === id)?.name; if(confirm(`[${tn}] ì „ì²´ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) { appData.tabs = appData.tabs.filter(t=>t.id!==id); delete appData.books[id]; switchTab(appData.tabs[0].id); } }
    function clearLogs() { if(confirm("ì „ì²´ ì‚­ì œ?")) { appData.logs = []; save(); renderLogs(); } }
    function deleteLog(idx) { if(confirm("ì‚­ì œ?")) { appData.logs.splice(idx, 1); save(); renderLogs(); } }
    function toggleSubjectExtract(sIdx) { appData.books[appData.activeTab][sIdx].extractEnabled = !appData.books[appData.activeTab][sIdx].extractEnabled; save(); }

    updateDDay = () => { 
        const now = new Date();
        document.getElementById("dday-1st").innerText = `1ì°¨ í•©ê²© D-${Math.ceil((examDate1st - now) / (1000 * 60 * 60 * 24))}`;
        document.getElementById("dday-2nd").innerText = `2ì°¨ í•©ê²© D-${Math.ceil((examDate2nd - now) / (1000 * 60 * 60 * 24))}`;
    };
    updateDDay(); renderTabs(); switchTab(appData.activeTab);
</script>
</body>
</html>
